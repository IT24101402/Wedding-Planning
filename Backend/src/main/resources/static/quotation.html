<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quotation Page</title>
    <link rel="stylesheet" href="quotation.css">
</head>
<body>
<h1>Quotation Page</h1>
<div class="card">
    <table>
        <thead>
        <tr>
            <th>Booking ID</th>
            <th>User</th>
            <th>Service</th>
            <th>Price</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr><td>001</td><td>Kasun</td><td>Wedding Dress</td><td>$100</td><td><button>Edit</button> <button>Delete</button></td></tr>
        <tr><td>002</td><td>Ilma</td><td>Banquet Hall</td><td>$200</td><td><button>Edit</button> <button>Delete</button></td></tr>
        </tbody>
    </table>
    <div class="total">Total: $300</div>
</div>
<button class="finalize-btn">Finalize Quotation</button>
<script>
    async function loadQuotation() {
        const username = localStorage.getItem('loggedInUser'); // ðŸ‘ˆ get logged in user
        const res = await fetch(`http://localhost:8080/billing/quotation?username=${username}`);
        const data = await res.json();
        let html = '';
        data.bookings.forEach((b, i) => {
            html += `<div class="booking">
                ${b.serviceType} - ${b.price}
                <button onclick="removeBooking(${i})">Delete</button>
            </div>`;
        });
        html += <p><strong>Total:</strong> ${data.total}</p>;
        document.getElementById('bookingList').innerHTML = html;
    }


    async function removeBooking(index) {
        await fetch(http://localhost:8080/billing/removeBooking/${index}, { method: 'DELETE' });
        loadQuotation();
    }

    async function finalize() {
        await fetch('http://localhost:8080/billing/finalize', { method: 'POST' });
        alert('Quotation finalized.');
    }

    loadQuotation();
</script>
</body>
</html>