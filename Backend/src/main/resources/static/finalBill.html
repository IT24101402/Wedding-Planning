<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Final Bill</title>
    <link rel="stylesheet" href="finalBill.css">
</head>
<body>
<h1>Final Bill </h1>
<h2 id="customerName" class="customer-name"></h2>

<div class="card">
    <table>
        <thead>
        <tr>
            <th>Vendor</th>
            <th>Service</th>
            <th>Price</th>
        </tr>
        </thead>
        <tbody id="quotationTableBody">
        <!-- Rows will be dynamically inserted here -->
        </tbody>
    </table>
    <div class="total" id="totalAmount">Total: $0</div>
</div>

<button class="finalize-btn">Finalize Bill</button>

<script>
    async function loadBill() {
        const username = sessionStorage.getItem('loggedInUser');
        document.getElementById('customerName').innerText = `Customer Name: ${username}`;
        const res = await fetch(`http://localhost:8080/billing/quotationByUser?username=${username}`);
        const data = await res.json();

        const tableBody = document.getElementById('quotationTableBody');
        tableBody.innerHTML = '';
        let total = 0;

        data.bookings.forEach((b, i) => {
            if (b.customerName === username) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${b.vendorName}</td>
                    <td>${b.serviceType}</td>
                    <td>${b.price}</td>
                `;
                tableBody.appendChild(row);
                total += b.price;
            }
        });

        document.getElementById('totalAmount').innerText = `Total: ${total}`;
    }

    loadBill();
</script>
</body>
</html>